<html>
	<head>
		<title></title>
		<meta content="">
		
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		
		<!-- Font Awesome Icons -->
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
		
		<style>
			#application { max-width: 750px; text-align: left; }
			
			div.taskpaper, textarea.taskpaper { width: 100%; max-width: 500px; min-height: 200px; border: 1px solid rgba(128,128,128,0.4); margin: 0; padding: 7px; overflow-y: scroll; overflow-x: hidden; resize: none; }
			
			.taskpaper ul, .taskpaper ol { padding-left: 0; margin: 0 0; }
			.taskpaper ul ul, .taskpaper ol ol, .taskpaper ul ol, .taskpaper ol ul { margin-left: 0; padding-left: 22px; }
			.taskpaper ul li { list-style-type: none; margin-left: 0; min-height: 21px; }
			.taskpaper ul li.note { margin-left: -22px; }
			.taskpaper .done > span.item { text-decoration: line-through; }
			.taskpaper .note { font-weight: normal; font-style: italic; color: #777; }
			.taskpaper .project { font-weight: bold; } .taskpaper .project ul { font-weight: normal; }
			.taskpaper li.project > span.item:after { content: ":"; }
			.taskpaper li.task:before, .taskpaper.editable li.task.done:hover:before { content: "\f10c"; font-family: FontAwesome; color: #999; text-decoration: none; display: inline-block; width: 22px; }
			.taskpaper li.task.done:before, .taskpaper.editable li.task:hover:before { content: "\f05d"; font-family: FontAwesome; color: #999; text-decoration: none; display: inline-block; width: 22px; }
			.taskpaper.editable li.task:hover:before, .taskpaper.editable li.task.done:hover:before { color: #966; }
			.taskpaper.editable li.task:hover { cursor: pointer; }
			.taskpaper li.task { margin-left: -22px !important; padding-left: -22px !important; }
			.taskpaper span.tag, .taskpaper tag { color: #933; }
			.taskpaper span.tag:before, .taskpaper tag:before { content: "@"; font-weight: bold; color: #D99; }
			.taskpaper span.tag > span.value, .taskpaper tag > value { visibility: hidden; }
			.taskpaper span.tag:hover > span.value, .taskpaper tag:hover > value { visibility: visible; }
			.taskpaper span.tag > span.value:before, .taskpaper tag > value:before { content: "("; font-weight: bold; color: #D99; }
			.taskpaper span.tag > span.value:after, .taskpaper tag > value:after { content: ")"; font-weight: bold; color: #D99; }
			.taskpaper span.tag.url, .taskpaper tag.url { cursor: alias; }
			.taskpaper li > span.tools { visibility: hidden; float: right; }
			.taskpaper li > span.tools a { color: #999; } .taskpaper li span.tools a:hover { color: #669; }
			.taskpaper.editable li:hover > span.tools { visibility: visible; }
			.taskpaper li > span.tools a { cursor: pointer; }
			.taskpaper li > span.tools a i.fa-bars { cursor: move; cursor: row-resize; cursor: ns-resize; }
			.taskpaper li.project > span.tools a i.fa-bars { cursor: move; }
			.taskpaper li > span.tools a i.fa-edit { cursor: text; }
			.taskpaper li.project > span.tools a i.fa-check { visibility: hidden; display: none; }
			/* .taskpaper ul > li:hover { background: rgba(128,128,128,0.1); } */
			
			
			.taskpaper ul.group { border: 1px solid #966; }
			
			.menu { width: 220px; float: right; margin: 0 10px 0 0; padding: 0; border: 1px solid #BBB; }
			.menu li, .menu ul, .menu ol { list-style-type: none; margin: 0; padding: 3px; }
			.menu li:hover { background: rgba(128,128,128,0.1); }
			.menu li.divider { height: 1px; border-top: 1px solid #BBB; margin: 7px 0; background: inherit; }
			.menu li span { color: #999; font-size: 9pt; float: right; }
			.menu a, .menu a:hover { text-decoration: none; color: #333; }
		</style>
		
	</head>
	<body>
		<center><div id="application">
		<div class="menu">
			<ul>
				<li><a href="#"><i class="fa fa-fw fa-dashboard"></i> Dashboard</a></li>
				<li><a href="#"><i class="fa fa-fw fa-calendar"></i> Calender</a></li>
				<li><a href="#"><i class="fa fa-fw fa-bar-chart"></i> Rapporten</a></li>
				<li class="divider"></li>
				<li><a href="#"><i class="fa fa-fw fa-sitemap"></i> Projecten</a></li>
				<li><a href="#"><i class="fa fa-fw fa-tasks"></i> Taken</a></li>
					<li><a href="#"><i class="fa fa-fw fa-bell-o"></i> Tickets</a></li>
				<li class="divider"></li>
				<li><a href="#"><i class="fa fa-fw fa-users"></i> Contacten</a> <span>(Heracles+)</span></li>
				<li><a href="#"><i class="fa fa-fw fa-comments-o"></i> Discussie</a> <span>(Echo)</span></li>
				<li><a href="#"><i class="fa fa-fw fa-tags"></i> Labels</a> <span>(Tags)</span></li>
				<li class="divider"></li>
				<li><a href="#"><i class="fa fa-fw fa-user"></i> Profiel</a> <span>(Heracles)</span></li>
				<li><a href="#"><i class="fa fa-fw fa-gears"></i> Configuratie</a></li>
				<li><a href="#"><i class="fa fa-fw fa-folder-open-o"></i> Bestandenbeheer</a></li>
			</ul>
		</div>
		<div id="taskpaper" class="taskpaper editable">
			<ul>
				<li class="project"><span class="item">Meterstanden</span> <span class="tools"><a href="#"><i class="fa fa-fw fa-bars"></i></a><a href="#"><i class="fa fa-fw fa-edit"></i></a><a href="#"><i class="fa fa-fw fa-check"></i></a><a href="#"><i class="fa fa-fw fa-close"></i></a></span>
				<ul>
					<li class="task"><span class="item">Opnemen</span> <tag>deadline<value>now</value></tag> <span class="tools"><a href="#"><i class="fa fa-fw fa-bars"></i></a><a href="#"><i class="fa fa-fw fa-edit"></i></a><a href="#"><i class="fa fa-fw fa-check"></i></a><a href="#"><i class="fa fa-fw fa-close"></i></a></span></li>
					<ul>
						<li class="task"><span class="item">Electra</span> <span class="tools"><a href="#"><i class="fa fa-fw fa-bars"></i></a><a href="#"><i class="fa fa-fw fa-edit"></i></a><a href="#"><i class="fa fa-fw fa-check"></i></a><a href="#"><i class="fa fa-fw fa-close"></i></a></span></li>
						<li class="task done"><span class="item">Water</span> <tag>done</tag> <span class="tools"><a href="#"><i class="fa fa-fw fa-bars"></i></a><a href="#"><i class="fa fa-fw fa-edit"></i></a><a href="#"><i class="fa fa-fw fa-check"></i></a><a href="#"><i class="fa fa-fw fa-close"></i></a></span></li>
					</ul>
					<li class="note"><span class="item">iedere mogelijke keer</span> <span class="tools"><a href="#"><i class="fa fa-fw fa-bars"></i></a><a href="#"><i class="fa fa-fw fa-edit"></i></a><a href="#"><i class="fa fa-fw fa-check"></i></a><a href="#"><i class="fa fa-fw fa-close"></i></a></span></li>
				</ul></li>
			</ul>
		</div>
			
			<br/><br/>
			
		<textarea id="taskpaper_raw" class="taskpaper">Meterstanden:
- Opnemen @deadline(now)
	- Electra
	- Water @done
		- Druppels
	iedere mogelijke keer</textarea>
			
			<button onClick="taskpaper_txt_analyse($('#taskpaper_raw').val());">txt Analyse</button>
			<button onClick="taskpaper_txt_build(taskpaper_txt_analyse($('#taskpaper_raw').val()));">txt2txt</button>
			<button onClick="alert($('#taskpaper_raw').val().length);">txt length</button> 
			<button onClick="$('#taskpaper').html( taskpaper_html_build(taskpaper_txt_analyse($('#taskpaper_raw').val())) );">txt2html</button>
			<!-- /*$('#taskpaper').innerHTML = */  -->
	
	</div></center>
	</body>
	
	

	<!-- jQuery 2.1.4 -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<!-- script>if (typeof jQuery === 'undefined') {
	  document.write(unescape('%3Cscript%20src%3D%22../jquery/jquery-2.1.4.min.js%22%3E%3C/script%3E'));
	}
	</script -->
	<!-- Bootstrap 3.3.6 JS -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<script language="JavaScript">
	function taskpaper_txt_analyse(blob){
		var debug = "";
		var lines = blob.split("\n");
		var clean = [];
		var db = [];
		for(var i = 0; i < lines.length ; i++){
			db[i] = [];
			/*default*/ db[i]['type'] = 'note'; 
			db[i]['clean'] = lines[i];
			//db[i]['raw'] = lines[i];
						
			db[i]['depth'] = 0; var dtab = lines[i].match(/^(\s+)/gi); if(dtab == null){ db[i]['depth'] = 0; } else { var dmatch = dtab[0].match(/[\t]/gi); db[i]['depth'] = (dmatch == null ? 0 : dmatch.length ); }
			if( cmatch = db[i]['clean'].replace(/^(\s+)(.*)/gi, "$2") ){ db[i]['clean'] = cmatch; }
			
			if( db[i]['clean'].match(/^([-]\s)/i) ){ db[i]['type'] = 'task'; db[i]['clean'] = db[i]['clean'].replace(/^([-]\s)(.*)/g, "$2"); }
			if( db[i]['clean'].match(/[:]\s*$/)){ db[i]['type'] = 'project'; db[i]['depth'] = db[i]['depth'] - 0.1; db[i]['clean'] = db[i]['clean'].replace(/^(.*)([:]\s*)$/g, "$1"); }
			
			if( db[i]['clean'].match(/@done/i) ){ db[i]['done'] = true; }
			
			debug = debug + "\n" + i+"\t"+ db[i]['depth']+":" +db[i]['type'] + "\t" + db[i]['clean'];
			//debug = debug + "\n" + i+ "\t" + lines[i];
		}
		alert( debug );
		return db;
	}
	function taskpaper_html_build(db){
		var html = null;
		var previous = null;
		var groupid = null; var groupparent = [];
		var d = 0;
		
		for(var i = 0; i < db.length ; i++){
			if( previous == null ){ d = Math.ceil(db[i]['depth']); }
			else { d = ( db[i]['depth'] - db[previous]['depth'] ); }
			
			if(db[i]['type'] == 'project'){
				groupparent[i] = groupid;
				groupid = i;
			}
			else{ if(groupid != null ){ if( db[groupid]['depth'] > db[i]['depth'] || db[i]['clean'].length == 0 ){
				groupid = null;
				html = html + taskpaper_close_group_helper(groupid, db, groupparent);
			}}}
			
			html = (html == null ? "" : html + "\n") + ( d == 0 ? "" : ( d > 0 ? repeat('<ul>', d) : repeat('</ul>', d * -1 ) ) ) + '<li class="' + db[i]['type'] + (db[i]['done'] ? ' done' : '') + ' depth-' + Math.ceil(db[i]['depth']) + '"><span class="item">' + db[i]['clean'] + '</span>' + (groupid == i ? '<ul class="group">' :  '</li>');
			
			previous = i;
		}
		html = html + taskpaper_close_group_helper(groupid, db, groupparent); previous = groupid;
		if(previous != null){ html = html + "\n" + repeat('</ul>', db[previous]['depth']); }
		if(Math.ceil(db[0]['depth']) == 0 ){ html = "<ul>\n"  + html + "\n</ul>"; }
		alert( html );
		return html;	
	}
	function taskpaper_close_group_helper(groupid, db, groupparent){
		var html = '';
		
		html = html + '</ul ></li>';
		return html;
	}
	function taskpaper_txt_build(db){
		var txt = null;
		for(var i = 0; i < db.length ; i++){
			txt = (txt == null ? "" : txt + "\n") + repeat("\t", db[i]['depth']) + (db[i]['type'] == 'task' ? "- " : "") + db[i]['clean'] + (db[i]['type'] == 'project' ? ":" : "");
		}
		alert( txt + " (" + txt.length + ")" );
		return txt;
	}
		
	function repeat(pattern, count) {
		count = Math.ceil(count);
		if (count < 1) return '';
		var result = '';
		while (count > 1) {
			if (count & 1) result += pattern;
			count >>= 1, pattern += pattern;
		}
		return result + pattern;
	}
	</script>
	
</html>